<html>

<head>
  <title>StudentDatabase</title>
  <style>
    .container {
      display: flex;
      gap: 10px;
      margin-top: 10%;
    }

    .frame {
      border: 1px solid black;
    }

    .label {
      width: 50px;
    }

    .clr {
      background-color: rgb(33, 185, 58);
      border-radius: 10px;
      color: black;
    }

    .add {
      background-color: black;
      color: white;
    }

    .clr2 {
      background-color: brown;
      border-radius: 6px;
      color: white;
    }

    .addLabel {
      display: flex;
      justify-content: right;
      padding-bottom: 10px;
    }

    td,
    th {
      border: 1px solid #dddddd;
      text-align: left;
    }

    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <div>
      <div class="addLabel">
        <button class="add" onclick="addStudent()">Add Student</button>
      </div>
      <table class="frame">
        <thead>
          <tr>
            <th>Name</th>
            <th>Tamil</th>
            <th>English</th>
            <th>Maths</th>
            <th>Science</th>
            <th>Social</th>
            <th>Total</th>
            <th>Rank</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="studentList">
        </tbody>
      </table>
</body>
<script>
  var studentList = document.getElementById("studentList")
  function addStudent() {
    var studentRow = `<tr>
              <td><input type="text" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="text" result="total" readonly class="label" /></td>
              <td><input type="text" result="rank" readonly class="label" /></td>
              <td>
                  <button class="clr" onclick="deleteRow(this)">Delete</button></td>
              </tr>`
    studentList.insertAdjacentHTML('beforeend', studentRow);
  }

  function updateRanks() {
    var total = []
    let studentRows = Array.from(document.querySelectorAll('#studentList tr'))
    var totalMarksArray = studentRows.map(row => {
      var totalInput = row.querySelector('input[result="total"]')
      return { 
        total: parseInt(totalInput.value || 0),
        row,
      }
    })
    var sortedRanks = totalMarksArray.sort((a,b) => b.total-a.total)
    sortedRanks.forEach((element, index) => {
        var rankInput = element.row.querySelector('input[result="rank"]');
        rankInput.value = index + 1;
      });
  }

  function changeMark(e) {
    const tableRow = e.parentElement.parentElement;
    const numberInputs = tableRow.querySelectorAll('input[type="number"]');
    var total = 0
    numberInputs.forEach(function (inputbox) {
      total = total + parseInt(inputbox.value || 0)
    });
    const totalInput = tableRow.querySelector('input[result="total"]');
    totalInput.value = total
    updateRanks()
  }

  function deleteRow(e) {
    e.parentElement.parentElement.remove()
    updateRanks()
  }
</script>

</html>