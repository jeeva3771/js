<html>

<head>
  <title>StudentDatabase</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    .addstud {
      background-color: black;
      color: white;
      height: 40px;
      border-radius: 4px;
      cursor: pointer;
    }

    .addLabel {
      display: flex;
      justify-content: right;
      padding-bottom: 10px;
    }

    .radioButton {
      font-family: inherit;
      font-size: large;
      font-weight: 500;
    }

    .label {
      border: none;
    }

    table input[type] {
      width: 100px;
    }

    .rowError td {
      background-color: red;
    }

    .container {
      width: 1030px;
    }

    .resize {
      display: flex;
      justify-content: center;
    }

    .radioLabel {
      margin-top: 10px;
    }

    input[type=radio] {
      border: 1px solid gray;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="form-check form-check-inline radioLabel">
      <input class="form-check-input" type="radio" checked name="inlineRadioOptions" onclick="total()" id="inlineRadio1"
        value="option1">
      <label class="form-check-label radioButton" for="inlineRadio1">Total</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" onclick="Priority()" name="inlineRadioOptions" id="inlineRadio2"
        value="option2">
      <label class="form-check-label radioButton" for="inlineRadio2">Priority</label>
    </div>
    <div class="addLabel">
      <button class="addstud" onclick="addStudent()">Add Student</button>
    </div>
    <div class="resize">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Tamil</th>
            <th scope="col">English</th>
            <th scope="col">Maths</th>
            <th scope="col">Science</th>
            <th scope="col">Social</th>
            <th scope="col">Total</th>
            <th scope="col">Rank</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="studentList">

        </tbody>
      </table>
    </div>
  </div>
</body>
<script>
  var studentList = document.getElementById("studentList")

  function addStudent() {
    var studentRow = `<tr>
              <td><input type="text" class="form-control"/></td>
              <td><input type="number" onkeyup="changeMark(this)" class="form-control" /></td>
              <td><input type="number" onkeyup="changeMark(this)" class="form-control" /></td>
              <td><input type="number" onkeyup="changeMark(this)" class="form-control" /></td>
              <td><input type="number" onkeyup="changeMark(this)" class="form-control" /></td>
              <td><input type="number" onkeyup="changeMark(this)" class="form-control" /></td>
              <td><input type="text" result="total" readonly class="form-control" /></td>
              <td><input type="text" result="rank" readonly class="form-control" /></td>
              <td>
                  <button type="button" class="btn btn-primary" onclick="deleteRow(this)">Delete</button></td>
              </tr>`
    studentList.insertAdjacentHTML('beforeend', studentRow);
  }

  function updateRanks() {
    let studentRows = Array.from(document.querySelectorAll('#studentList tr'))
    var totalMarksArray = studentRows.map((row) => {
      var totalInput = row.querySelector('input[result="total"]')
      return {
        total: parseInt(totalInput.value || 0),
        row,
      }
    })
    var sortedRanks = totalMarksArray.sort((a, b) => b.total - a.total)
    var currentRank = 0;
    var sameRank = 1
    for (var i = 0; i < sortedRanks.length; i++) {
      var element = sortedRanks[i];
      var rankInput = element.row.querySelector('input[result="rank"]');
      var isFailGrade = Array.from(element.row.querySelectorAll('input[type="number"]')).some((input) => input.value < 35);

      if (isFailGrade) {
        rankInput.value = 0;
      } else {
        if (i > 0 && sortedRanks[i].total === sortedRanks[i - 1].total) {
          rankInput.value = currentRank;
          sameRank++
        } else {
          if (sameRank > 1) {
            currentRank = currentRank + sameRank
            sameRank = 1
          } else {
            currentRank++;
          }
          rankInput.value = currentRank;
        }

      }
    }
  }

  function changeMark(e) {
    if (e.value < 0) e.value = '';
    if (e.value > 100) e.value = '';
    const tableRow = e.parentElement.parentElement;
    const numberInputs = tableRow.querySelectorAll('input[type="number"]');
    var total = 0
    var isEmptyValue = false

    numberInputs.forEach(function (inputbox) {
      if (inputbox.value === '') {
        isEmptyValue = true
      }
      total = total + parseInt(inputbox.value || 0)
    });
    const totalInput = tableRow.querySelector('input[result="total"]');
    totalInput.value = total

    if (isEmptyValue) {
      tableRow.classList.add('rowError');
    } else {
      tableRow.classList.remove('rowError');
    }
    updateRanks()
  }

  function deleteRow(e) {
    e.parentElement.parentElement.remove()
    updateRanks()
  }

  function total() {
    let studentRows = Array.from(document.querySelectorAll('#studentList tr'))
    // console.log(studentRows)
    var totalMarksArray = studentRows.map((row) => {
      var totalInput = row.querySelector('input[result="total"]')
      return {
        total: parseInt(totalInput.value || 0),
        row,
      }
    })
    var sortedRanks = totalMarksArray.sort((a, b) => a.total - b.total)
    sortedRanks.forEach((student) => {
      studentList.appendChild(student.row);
    })
  }

  function Priority() {
    let student = Array.from(document.querySelectorAll('#studentList tr'))
    var studentName = student.map((row) => {
      var name = row.querySelector('input[type="text"]')
      return {
        studName: name.value,
        row,
      }
    })
    // var sort = studentName.sort()
    // console.log(sort)

    var currentUsers = studentName.sort((a, b) => {
      if (a.studName > b.studName) {
        return 1;
      } else if (a.studName < b.studName) {
        return -1;
      }
    })
    currentUsers.forEach((student) => {
      studentList.appendChild(student.row);
    })
    var studentMarkTr = Array.from(document.querySelectorAll('#studentList tr'))
      var marks = studentMarkTr.map((row) => {
        var marksValue = row.querySelector('input[type="number"]')
        return {
          studMarks: marksValue.value,
          row,
        }
      })
      //console.log(marks)
      marks.forEach(marksnum => {
        console.log(marksnum)
      })
  }
</script>

</html>