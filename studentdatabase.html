<html>

<head>
  <title>StudentDatabase</title>
  <style>
    .clr {
      background-color: rgb(33, 185, 58);
      border-radius: 10px;
      color: black;
    }

    .addstud {
      background-color: black;
      color: white;
      height: 40px;
      border-radius: 4px;
    }

    .clr2 {
      background-color: brown;
      border-radius: 6px;
      color: white;
    }

    .addLabel {
      display: flex;
      justify-content: right;
      padding-bottom: 10px;
    }

    .label {
      border: none;
    }

    td,
    th {
      border: 1px solid #dddddd;
      text-align: left;
    }

    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    table input[type=number] {
      width: 100px;
    }
  </style>
</head>

<body>
  <div style="width: 800px; margin: 0px auto;">
    <div class="addLabel">
      <button class="addstud" onclick="addStudent()">Add Student</button>
    </div>
    <table class="table caption-top">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Tamil</th>
          <th scope="col">English</th>
          <th scope="col">Maths</th>
          <th scope="col">Science</th>
          <th scope="col">Social</th>
          <th scope="col">Total</th>
          <th scope="col">Rank</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody id="studentList">
  
      </tbody>
    </table>
  </div>
</body>
<script>
  var studentList = document.getElementById("studentList")
  function addStudent() {
    var studentRow = `<tr>
              <td><input type="text" class="label"/></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="number" onchange="changeMark(this)" class="label" /></td>
              <td><input type="text" result="total" readonly class="label" /></td>
              <td><input type="text" result="rank" readonly class="label" /></td>
              <td>
                  <button class="clr" onclick="deleteRow(this)">Delete</button></td>
              </tr>`
    studentList.insertAdjacentHTML('beforeend', studentRow);
  }


  function updateRanks() {
    let studentRows = Array.from(document.querySelectorAll('#studentList tr'))
    var totalMarksArray = studentRows.map((row) => {
      var totalInput = row.querySelector('input[result="total"]')
      return {
        total: parseInt(totalInput.value || 0),
        row,
      }
      
    })
    var sortedRanks = totalMarksArray.sort((a, b) => b.total - a.total)
    sortedRanks.forEach((element, index) => {
      var rankInput = element.row.querySelector('input[result="rank"]')
      var isFailGrade = Array.from(element.row.querySelectorAll('input[type="number"]')).some((input)=>input.value <35)
      rankInput.value = isFailGrade ? 0 : index + 1
      changeMark() 
    })
  }

  function changeMark(e) {
    // if (e.value < 0) e.value = 0;
    // if (e.value > 100) e.value = 100;

  //   function changeMark(e) {
  //   if (e.value < 0 || e.value > 100) {
  //     e.style.display = 'inline';
  //   } else {
  //     e.style.display = 'none';
  //   }
  // }
    const tableRow = e.parentElement.parentElement;
    const numberInputs = tableRow.querySelectorAll('input[type="number"]');
    var total = 0
    numberInputs.forEach(function (inputbox) {
      total = total + parseInt(inputbox.value || 0)
    });
    const totalInput = tableRow.querySelector('input[result="total"]');
    totalInput.value = total
    updateRanks()
  }

  function deleteRow(e) {
    e.parentElement.parentElement.remove()
    updateRanks()
  }
</script>

</html>